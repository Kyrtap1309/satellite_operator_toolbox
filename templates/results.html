<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Satellite Passes Results</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/vis-timeline@7.7.0/dist/vis-timeline-graph2d.min.css">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <script src="https://cdn.jsdelivr.net/npm/vis-timeline@7.7.0/dist/vis-timeline-graph2d.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/moment@2.29.4/moment.min.js"></script>
</head>
<body>
    <div class="container-fluid mt-4">
        <div class="row justify-content-center">
            <div class="col-md-11">
                <div class="card shadow-sm mb-4">
                    <div class="card-header bg-primary text-white">
                        <h2 class="text-center mb-0">Satellite Passes for {{ date }}</h2>
                    </div>
                    <div class="card-body">
                        <div class="timeline-container mb-5">
                            <h3 class="text-center mb-3">Visual Timeline</h3>
                            <div id="visualization"></div>
                        </div>

                        <h3 class="text-center mb-3">Common Visibility Windows</h3>
                        <div class="table-responsive">
                            <table class="table table-striped table-bordered">
                                <thead class="table-primary">
                                    <tr>
                                        <th>Nr</th>
                                        <th>Date</th>
                                        <th>Start (UTC)</th>
                                        <th>End (UTC)</th>
                                        <th>Max Elevation</th>
                                        <th>Duration</th>
                                    </tr>
                                </thead>
                                <tbody>
                                    {% if common_windows %}
                                        {% for window in common_windows %}
                                            <tr>
                                                <td>{{ window.Nr }}</td>
                                                <td>{{ window.Date }}</td>
                                                <td>{{ window['Start (UTC)'] }}</td>
                                                <td>{{ window['End (UTC)'] }}</td>
                                                <td>{{ window['Max Elevation'] }}</td>
                                                <td>{{ window.Duration }}</td>
                                            </tr>
                                        {% endfor %}
                                    {% else %}
                                        <tr>
                                            <td colspan="6" class="text-center">No common visibility windows found</td>
                                        </tr>
                                    {% endif %}
                                </tbody>
                            </table>
                        </div>

                        <div class="row mt-5">
                            <div class="col-md-6">
                                <h3 class="text-center mb-3">{{ gs1_name }} Station Passes</h3>
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered">
                                        <thead class="table-primary">
                                            <tr>
                                                <th>Nr</th>
                                                <th>Date</th>
                                                <th>Rise (UTC)</th>
                                                <th>Set (UTC)</th>
                                                <th>Max Elevation</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% if gs1_passes %}
                                                {% for pass in gs1_passes %}
                                                    <tr>
                                                        <td>{{ pass.Nr }}</td>
                                                        <td>{{ pass.Date }}</td>
                                                        <td>{{ pass['Rise Time (UTC)'] }}</td>
                                                        <td>{{ pass['Set Time (UTC)'] }}</td>
                                                        <td>{{ pass['Max Elevation'] }}</td>
                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="5" class="text-center">No passes found</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                            <div class="col-md-6">
                                <h3 class="text-center mb-3">{{ gs2_name }} Station Passes</h3>
                                <div class="table-responsive">
                                    <table class="table table-striped table-bordered">
                                        <thead class="table-primary">
                                            <tr>
                                                <th>Nr</th>
                                                <th>Date</th>
                                                <th>Rise (UTC)</th>
                                                <th>Set (UTC)</th>
                                                <th>Max Elevation</th>
                                            </tr>
                                        </thead>
                                        <tbody>
                                            {% if gs2_passes %}
                                                {% for pass in gs2_passes %}
                                                    <tr>
                                                        <td>{{ pass.Nr }}</td>
                                                        <td>{{ pass.Date }}</td>
                                                        <td>{{ pass['Rise Time (UTC)'] }}</td>
                                                        <td>{{ pass['Set Time (UTC)'] }}</td>
                                                        <td>{{ pass['Max Elevation'] }}</td>
                                                    </tr>
                                                {% endfor %}
                                            {% else %}
                                                <tr>
                                                    <td colspan="5" class="text-center">No passes found</td>
                                                </tr>
                                            {% endif %}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        </div>
                        
                        <div class="text-center mt-4">
                            <a href="{{ url_for('index') }}" class="btn btn-primary">Calculate New Passes</a>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Parse the timeline data
            const timelineData = {{ timeline_data|safe }};
            
            // Create groups
            const groups = [
                {id: '{{ gs1_name }}', content: '{{ gs1_name }} Station'},
                {id: '{{ gs2_name }}', content: '{{ gs2_name }} Station'},
                {id: 'Common', content: 'Common Visibility'}
            ];
            
            // Create a DataSet with the parsed data
            const items = new vis.DataSet(timelineData);
            
            // DOM element where the Timeline will be attached
            const container = document.getElementById('visualization');
            
            // Configuration for the Timeline
            const options = {
                zoomable: true,
                moveable: true,
                stack: false,
                min: new Date('{{ date }} 00:00:00'),
                max: new Date('{{ date }} 23:59:59'),
                timeAxis: {scale: 'minute', step: 30}
            };
            
            // Create a Timeline
            const timeline = new vis.Timeline(container, items, groups, options);
        });
    </script>
</body>
</html>